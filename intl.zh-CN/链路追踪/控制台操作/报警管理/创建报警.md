# 创建报警

通过创建报警，您可以制定针对特定监控对象的报警规则。当规则被触发时，系统会以您指定的报警方式向报警联系人分组发送报警信息，以提醒您采取必要的问题解决措施。

-   已成功创建监控任务，请参见[创建应用监控任务](/intl.zh-CN/快速入门/创建应用监控任务.md)、[创建自定义监控任务]()。
-   创建联系人：仅可将联系人分组设为报警的通知对象。

默认报警条件：

-   为避免您在短时间内收到大量报警信息，系统 24 小时内对于持续的重复报警信息仅发送一条消息。
-   如果 5 分钟内没有重复报警，则会发送恢复邮件，通知数据恢复正常。
-   发送恢复邮件后，报警的状态会重置。如果该报警再次出现，会被视为新报警。

报警控件本质是数据集的数据展示方式，所以在创建报警控件的同时，会创建一个数据集来存储报警控件的底层数据。

**说明：** 新建报警大约在 10 分钟内生效，报警判断会存在 1 ~ 3 分钟的延时。

## 创建应用监控报警

若需为应用监控任务创建一个 JVM-GC 次数同比报警，具体操作步骤如下：

1.  登录[ARMS控制台](https://arms.console.aliyun.com/#/home)[ARMS控制台](https://arms-ap-southeast-1.console.aliyun.com/#/home)。

2.  在左侧导航栏中选择**报警管理** \> **报警策略管理** 。

3.  在报警策略管理页面的右上角单击**创建报警** \> **应用监控报警**。

4.  在**创建报警**对话框中输入所有必填信息，完成后单击**保存**。

    1.  填写**报警名称**，例如：JVM-GC 次数同比报警。

    2.  在**应用站点**列表中选择应用，在**应用组**列表中选择应用组。

    3.  在**类型**列表中选择监控指标的类型，例如：**JVM 监控**。

    4.  设置维度为**遍历**。

    5.  设置报警规则。

        1.  单击**同时满足下述规则**。
        2.  编辑报警规则，例如：N = 5 时 JVM\_FullGC 次数的平均值与上小时同比上升 100% 时则报警。

            **说明：** 若需设置多条报警规则，单击**报警规则**右侧的 **＋** 号，即可编辑第二条报警规则。

    6.  勾选通知方式。例如：勾选邮件。

    7.  设置通知对象。在**全部联系组**框中单击联系人分组的名称，该联系人分组出现**在已选联系组**框中，则设置成功。

    ![Application Monitoring Alarm](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1557559951/p43504.png)


## 创建前端监控报警

若需为前端监控任务创建一个页面指标 JS 错误率和 JS 错误数报警，具体操作步骤如下：

1.  在左侧导航栏中选择**报警管理** \> **报警策略管理** 。

2.  在报警策略管理页面的右上角单击**创建报警** \> **前端监控报警**。

3.  在弹出的**创建报警**对话框中输入所有必填信息，完成后单击**保存**。

    1.  填写报警名称，例如：页面指标报警。

    2.  在**应用站点**栏选择您已创建的监控任务。

    3.  在**类型**栏选择监控指标的类型，例如：**页面指标**。

    4.  设置维度为**遍历**。

    5.  设置报警规则。

        1.  勾选**同时满足下述规则**。
        2.  编辑报警规则，例如：N = 10 时 JS 错误率的的平均值大于等于 20 时则报警。
        3.  单击报警规则右侧的 **＋** 号，编辑第二条报警规则，例如：N = 10 时 JS 错误数的的总和大于等于 20 时则报警。
    6.  勾选通知方式，例如：勾选短信和邮件。

    7.  设置通知对象。在**全部联系组**中单击联系人分组的名称，该联系人分组出现**在已选联系组**中，则设置成功。

    ![Browser Monitoring Alarm](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2032775061/p43505.png)


## 创建自定义监控报警

若需为自定义监控任务创建一个用户接入报警，具体操作步骤如下：

1.  在左侧导航栏中选择**报警管理** \> **报警策略管理**。

2.  在报警策略管理页面的右上角单击**创建报警** \> **自定义监控报警**。

3.  在**创建报警**对话框中输入所有必填信息，完成后单击**保存**。

    1.  填写报警名称，例如：用户接入通知。

    2.  选择类型为**基于已有下钻数据集创建报警**。

    3.  定义报警变量。为变量 a 选择一个数据集，设置下钻维度为遍历。

        **说明：** 若您想定义多个报警变量，您可以单击**报警变量定义**项右侧的**＋** 号，在弹出的编辑框中定义变量 b。

    4.  设置报警规则。

        1.  勾选**同时满足下述规则**。
        2.  编辑报警规则，例如：N = 3 时用户创建 Agent 数的平均值大于等于 0 时则报警。

            **说明：** 您的报警规则中还可以包含简单复合指标：例如 N = 3 时，（数据集 A / 数据集 B ）的平均值大于等于 5 则报警。

    5.  勾选通知方式，例如：勾选邮件。

    6.  设置通知对象。在**全部联系组**中单击联系人分组的名称，该联系人分组出现在**已选联系组**中，即设置成功。

    ![Custom Monitoring Alarm](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2032775061/p43507.png)


## 创建 Prometheus 监控报警

若需为 Prometheus 监控任务创建报警，例如网络接收压力报警，具体操作步骤如下：

1.  报警创建提供两个入口，您可根据需要自行选择其中一个入口进入创建报警环节。

    -   在 [ARMS Prometheus Grafana 大盘](http://grafana.console.aliyun.com/)的 New DashBoard 页面，单击左侧的 图标，跳转至 ARMS Prometheus 创建报警对话框。
    -   在控制台左侧导航栏中选择**报警管理** \> **报警策略管理**，进入报警策略管理页面，在右上角单击**创建报警** \> **Prometheus**。
2.  在**创建报警**对话框中输入所有必填信息，完成后单击**保存**。

    1.  填写报警名称，例如：网络接收压力报警。

    2.  选择要创建报警的 Prometheus 监控对应的**集群**。

    3.  选择**类型**为 **grafana**。

    4.  选择要监控的具体**大盘**和**图表**。

    5.  设置报警规则。

        1.  勾选**同时满足下述规则**。
        2.  编辑报警规则，例如：N = 5 时网络接收数据字节（MB）的平均值大于等于 3 时则报警。

            **说明：** 一个 Grafana 图表中可能有 A、B、C 三条曲线数据，您可设置监控其中的一条线。

        3.  在 **PromQL** 输入框中编辑或重新输入 PromQL 语句。

            **说明：** PromQL 语句中包含的“$”符号会导致报错，您需要删除包含“$”符号的语句中“=”左右两边的参数及“=”。例如：将`sum (rate (container_network_receive_bytes_total{instance=~"^$HostIp.*"}[1m]))`修改为`sum (rate (container_network_receive_bytes_total[1m]))`

    6.  勾选通知方式，例如：勾选短信。

    7.  设置通知对象。在**全部联系组**中单击联系人分组的名称，该联系人分组出现在**已选联系组**中，即设置成功。

    ![Prometheus Monitoring Alarm](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1557559951/p61774.png)


## 通用基础字段含义

**创建报警**对话框的基础字段含义见下表。

![ARMS-创建报警对话框](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1557559951/p43306.png)

|字段|含义|说明|
|--|--|--|
|应用站点|已创建的监控任务。|在下拉菜单中选择。|
|报警类型|报警指标的类型。|三种报警的报警指标类型各不相同： -   应用监控报警：应用入口调用、应用调用类型统计、数据库指标、JVM 监控、主机监控和异常接口调用。
-   前端监控报警：页面指标、API 指标、自定义指标和页面 API 指标。
-   自定义监控报警：基于已有下钻数据集创建报警和基于已有通用数据集创建报警。 |
|报警维度|配置报警指标（数据集）的维度，可选择为：无、= 、遍历。|-   配置为无：报警内容中透出这个维度所有数值的和。
-   配置为 = ：具体内容需手动填写。
-   配置为遍历：会在报警内容中透出实际触发报警的维度内容。 |
|最近 N 分钟|报警判断最近 N 分钟内数据结果是否达到触发条件。|N 的范围为：3~3600 分钟。|
|通知方式|支持邮件、短信和钉钉机器人三种方式。|可勾选多种方式。若需设置钉钉机器人报警请参见[设置钉钉机器人报警](/intl.zh-CN/大盘和报警/设置钉钉机器人报警.md)。|
|报警静默期开关|可选择为开启或关闭，默认为开启状态。|-   开启报警静默期开关：若数据一直处于触发状态，首次触发报警后，24 小时后才会发送第二次报警信息。当数据恢复正常，会收到数据恢复通知并解除报警。若数据再次触发报警，则会再次发送报警信息。
-   关闭报警静默期开关：若报警连续触发，将会每分钟发送一次报警信息。 |
|报警级别|包括警告、错误和致命。|-|
|通知时间|报警发送时的通知时间。此时间范围外将不发送报警通知，但仍会有报警事件记录。|查看报警事件记录请参见[管理报警](/intl.zh-CN/大盘和报警/管理报警.md)。|
|通知内容|自定义的报警通知内容。|您可以编辑默认模板。在模板中，除 $报警名称、$筛选、 $报警时间和 $报警内容等 4 个变量（暂不支持其它变量）为固定搭配，其余内容均可自定义。|

## 通用复杂字段含义：环比与同比

-   环比上升 / 下降 % ：若 β 为最近 N 分钟的数据（可选择为平均值、总和、最大值和最小值），α 为前 2N 分钟到前 N 分钟的数据， 环比为 β 与 α 做比较。

    ![Day-on-day Growth or Decline](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/arms/dg_chain_workflow.png)

-   与上小时同比上升 / 下降 %：若 β 为最近 N 分钟的数据（可选择为平均值、总和、最大值和最小值），α 为上小时最近 N 分钟的数据，与上小时同比为 β 与 α 做比较。

    ![Growth or Decline](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/arms/dg_hoh_workflow.png)

-   与昨日同比上升 / 下降 %：若 β 为最近 N 分钟的数据（可选择为平均值、总和、最大值和最小值），α 为昨日同一时刻最近 N 分钟的数据，与昨日同比为 β 与 α 做比较。

    ![Growth or Decline](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/arms/dg_dod_workflow.png)


## 通用复杂字段含义：报警数据修订策略

报警数据修订策略可选择为补零、补一或补零 Null（默认）。此功能一般用于无数据、复合指标和环比同比等异常的数据修复。

-   补零： 将被判断的数值修复为 0。
-   补一： 将被判断的数值修复为 1。
-   补零 Null： 不会触发报警。

应用场景：

-   异常情况一：无数据

    用户 A 想利用报警功能监控页面访问量。创建报警时，选择前端监控报警，设置报警规则为 N = 5 时页面访问量的总和小于等于 10 则报警。若该页面一直没有被访问，则没有数据上报，不会发送报警。为解决此类问题，可将报警数据修订策略勾选为补零，将没有收到数据视为收到零条数据，符合报警规则，即可发送报警。

-   异常情况二：复合指标异常

    用户 B 想利用报警功能监控商品的实时单价。创建报警时，选择自定义监控报警，设置变量 a 的数据集为当前总价，变量 b 的数据集为当前商品总数，报警规则为 N = 3 时 （当前总价）/（当前商品总数）的最小值小于等于 10 则报警。若当前商品总数为 0 时，复合指标（当前总价）/（当前商品总数）的值不存在，则不会发送报警。为解决此类问题，可将报警数据修订策略勾选为补零，将复合指标（当前总价）/（当前商品总数）的值视为 0，符合报警规则，即可发送报警。

-   异常情况三：指标环比、同比异常

    用户 C 想利用报警功能监控节点机用户使用 CPU 百分比。创建报警时，选择应用监控，设置报警规则为 N = 3 时节点机用户使用 CPU 百分比的平均值环比下降 100% 则报警。若最近 N 分钟用户的 CPU 故障无法工作，即 α 无法获取，导致环比结果不存在，则不会发送报警。为解决此类问题，可将报警数据修订策略勾选为补一，将环比结果视为下降 100%，符合报警规则，即可发送报警。


您可以在管理报警系统中查询和删除报警记录。

