# 诊断服务端报错问题

网页抛错是互联网应用最常见的问题之一，但其错因分析是一个难点。为应用安装ARMS探针后，就能在不改动应用代码的情况下，借助ARMS应用监控的异常自动捕捉、收集、统计和溯源等功能，准确定位应用中所有异常并进行线上诊断。

## 问题描述

网页抛错，尤其是5xx错误是互联网应用最常见的问题之一。5xx错误通常发生于服务端。服务端是业务逻辑最复杂，也是整条网络请求链路中最容易出错、出了错之后最难诊断原因的地方。运维工程师或研发工程师往往需要登录机器查看日志来定位问题。

![常见的Java应用错误日志](../images/p42274.png "示例：常见的Java应用错误日志")

对于逻辑不太复杂、上线时间不长的应用来说，登录机器查看日志的方式能够解决大部分网站抛错的问题。但在以下场景中，传统的问题诊断方式往往没有用武之地。

-   在一个分布式应用集群中，需知道某一类错误的发生时间和频率。
-   某系统已运行了很长时间，但是不想关心遗留的异常，只想知道今天和昨天相比、发布后和发布前相比多了哪些异常。
-   查看一个异常对应的Web请求和相关参数。
-   客服人员提供了一个用户下单失败的订单号，分析该用户下单失败的原因。

## 解决方案

为应用安装ARMS探针后，即可在不改动应用代码的情况下，利用ARMS应用监控的异常自动捕捉、收集、统计和溯源等能力，全面掌握应用的各种错误信息。

## 步骤一：安装ARMS探针

为应用安装ARMS探针后，才能对应用进行全方位监控。请根据实际需求选择一种方式来安装探针。

-   为Java应用安装探针，请参见[为Java应用手动安装Agent](/intl.zh-CN/应用监控/开始监控 Java 应用/为Java应用手动安装Agent.md)。
-   为PHP应用安装探针，请参见[为普通PHP应用安装探针](/intl.zh-CN/应用监控/开始监控 PHP 应用/为普通PHP应用安装探针.md)。
-   为EDAS上的应用安装探针，请参见[为部署在EDAS中的应用接入ARMS](/intl.zh-CN/应用监控/开始监控 Java 应用/为部署在EDAS中的应用接入ARMS.md)。
-   为容器服务Kubernetes版上的应用安装探针，请参见[t152230.md\#](/intl.zh-CN/应用监控/开始监控 Java 应用/为容器服务Kubernetes版Java应用安装探针.md)。
-   为开源Kubernetes中的应用安装探针，请参见[为开源Kubernetes环境中的应用安装探针](/intl.zh-CN/应用监控/开始监控 Java 应用/为开源Kubernetes环境中的应用安装探针.md)。

## 步骤二：查看关于应用异常的统计信息

为应用安装ARMS探针后，ARMS会收集和展示选定时间内应用的总请求量、平均响应时间、错误数、实时实例数、FullGC次数、慢SQL次数、异常次数和慢调用次数，以及这些指标和上一天的环比、上周的同比升降幅度。请按以下步骤查看应用异常的统计信息。

1.  登录[ARMS控制台](https://arms-ap-southeast-1.console.aliyun.com/#/home)。

2.  在左侧导航栏，选择**应用监控** \> **应用列表**。

3.  在顶部菜单栏，选择地域。

4.  在**应用列表**页面，单击您的应用名称。

5.  在**应用总览**页面的**概览分析**页签下方，查看异常的总数、周同比和日同比数据。

    ![异常次数统计](../images/p47240.png "异常次数统计")

6.  滑动页面至**概览分析**页签底部的**统计分析**区域的**异常类型**，查看各类型异常出现的次数。

    ![各类型异常出现的次数](../images/p42279.png "各类型异常出现的次数")

7.  在左侧导航栏，单击**应用详情**，然后在页面右侧单击**异常分析**页签，查看异常统计图、错误数、异常堆栈等。

    ![异常分析页签](../images/p42280.png "异常分析页签")


## 步骤三：诊断异常出现的原因

掌握应用异常的统计信息还不足以诊断异常出现的原因。虽然日志中异常堆栈包含调用的代码片段，但并不包含这次调用的完整上下游信息和请求参数。ARMS探针采用了字节码增强技术，让您能够以很小的性能消耗捕获异常上下游的完整调用快照，进而找出导致异常出现的具体原因。

1.  在**异常分析**页签下，找到要诊断的异常类型，在其右侧**操作**列，单击**接口快照**。

    **接口快照**页签下显示与该异常类型相关的调用链路信息。

2.  在**接口快照**页签下，单击某个错误调用的TraceId。

    **说明：** 如何查找目标调用链路，请参见[调用链路查询](/intl.zh-CN/应用监控/控制台功能/调用链路查询.md)。

    ![接口快照页签](../images/p42281.png "接口快照页签")

3.  在弹出的页面，查看异常的调用链路信息，在**方法栈**列，单击放大镜图标，查看调用的方法栈，从而获得异常的上下文信息。

    ![异常的完整调用链路信息](../images/p42282.png "异常的完整调用链路信息")

    操作至此，您已发现了应用异常的原因，这将有效地帮助您进行下一步的代码优化工作。您还可以返回接口调用页面，查看列表中其他异常，逐一解决。


## 后续操作

为避免在出现问题后被动诊断错误原因，您还可以使用ARMS的报警功能针对一个接口或全部接口创建报警，即可在出现问题的第一时间向运维团队发送通知。如何创建报警，请参见[快速创建ARMS报警](/intl.zh-CN/快速入门/快速创建ARMS报警.md)。

## 更多信息

-   [创建应用监控任务](/intl.zh-CN/快速入门/创建应用监控任务.md)
-   [t152244.md\#](/intl.zh-CN/应用监控/控制台功能/接口调用.md)
-   [调用链路查询](/intl.zh-CN/应用监控/控制台功能/调用链路查询.md)
-   [使用线程剖析诊断代码层面的问题](/intl.zh-CN/应用监控/使用教程/使用线程剖析诊断代码层面的问题.md)
-   [快速创建ARMS报警](/intl.zh-CN/快速入门/快速创建ARMS报警.md)

