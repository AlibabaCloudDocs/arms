# 在Prometheus告警通知中配置指标走势图

ARMS Prometheus告警支持在钉钉群的告警卡片中增加指标走势图的展示。通过展示指标走势图可以获取更多关于该告警的信息，从而有助于排查和定位问题。本文主要介绍如何配置Prometheus告警才能在通知卡片中增加指标走势图。

-   已创建钉群，具体操作，请参见[钉群](/cn.zh-CN/告警管理（新版）/控制台操作/联系人管理/钉群.md)。
-   已设置钉群为告警通知人的通知策略，具体操作，请参见[通知策略](/cn.zh-CN/告警管理（新版）/控制台操作/通知策略.md)。

## 配置指标走势图

1.  登录[ARMS控制台](https://arms.console.aliyun.com/#/home)。

2.  在左侧导航栏，选择**Prometheus监控**。

3.  在**Prometheus监控**页面的顶部菜单栏，选择K8s集群所在的地域，单击目标K8s集群的名称。

4.  在左侧导航栏，选择**报警配置**。

5.  在报警配置页面：

    -   如果需要在已有告警中配置指标走势图，在需要增加指标走势图的告警右侧，单击**编辑**。
    -   如果需要在新建告警中配置指标走势图，单击页面右上角的**创建报警**。
6.  在**编辑报警**或**创建报警**面板，执行以下操作：

    1.  在**高级配置**的**注释**区域，单击**创建注释**，增加以下两个注释。

        |键|值|示例|
        |--|--|--|
        |\_aliyun\_display\_promql|用于展示指标走势图的查询PromQL语句，通常情况下是告警PromQL去掉阈值判断之后的语句。 例如：`cpu_usage > 80`需要改为`cpu_usage`。|`_aliyun_display_promql:cpu_usage`|
        |\_aliyun\_display\_name|指标走势图中指标的名称。|`_aliyun_display_name:容器CPU使用率`|

    2.  选择通知人为钉群的通知策略。

    3.  根据需要修改其他参数，其他参数的说明，请参见[创建报警]()。

    4.  单击**确定**。


## 查看指标走势图

配置完成后，当有告警触发时，在客户端钉钉群的告警卡片中查看指标走势图。

告警卡片中的其他信息，请参见[在钉钉群中处理告警](/cn.zh-CN/告警管理（新版）/最佳实践/在钉钉群中处理告警.md)。

![Prometheus告警指标走势图](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9988640261/p270316.png)

## 常见问题

-   为什么不使用告警的PromQL来获取指标走势图，还需要人为配置？

    用于告警的PromQL和用户展示图表的PromQL不完全相同（包含阈值判断，与、或逻辑等），在指标展示的PromQL中需要删除这部分内容。

-   为什么配置了\_aliyun\_display\_promql仍然无法展示图片？

    \_aliyun\_display\_promql与报警PromQL查询出的内容需要满足标签完全一致才能渲染图表。通常一个PromQL可以查出多条时间序列，告警需要根据标签筛选出其中一条时间序列来渲染走势图。例如`cpu_usage > 80`查出来的指标中包含了pod\_name、container 2个标签，那么对于的\_aliyun\_display\_promql查询结果也需要包含这两个标签。


