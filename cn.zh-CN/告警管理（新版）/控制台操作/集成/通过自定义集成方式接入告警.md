---
keyword: [告警, 监控, 自定义集成]
---

# 通过自定义集成方式接入告警

ARMS告警管理提供API接入的能力，通过对接告警管理的API可以将任意告警源产生的告警接入ARMS告警管理进行统一处理。

ARMS告警管理功能仅对2021年04月30日0点之后开通ARMS的阿里云账户支持。如果您想体验该功能，请联系ARMS钉钉服务账号`arms160804`开通使用。

## 步骤一：创建自定义集成

1.  登录[ARMS控制台](https://arms.console.aliyun.com/#/home)。

2.  在左侧导航栏选择**告警管理** \> **集成**。

3.  在集成页面的支持集成区域单击**自定义集成**。

4.  在添加集成配置向导页面，进行以下配置：

    1.  在基本信息向导页输入集成名称和描述，然后单击**下一步**。

    2.  在告警源配置向导页根据需求配置自动恢复告警事件的时间和事件重定义字段，然后单击**保存**。

        **说明：**

        -   事件重定义字段只能用变量和字符组成的jsonPath格式。
        -   单击向导页底部的**+添加扩展字段**可以自定义新的告警事件字段。
        ![自定义集成告警源配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1978121261/p272486.png)

        |参数|说明|
        |--|--|
        |告警源配置|
        |自动恢复告警事件|相同名称和等级的告警，在设置的时间内的多次上报会被合并为一条告警。当一条告警超过设置的时间后不再产生，则该告警状态自动变为已解决。|
        |事件重定义|
        |告警样本值|监控指标的触发值。|
        |告警等级|设置告警等级的映射字段。默认映射如下：        -   critical：P1
        -   error：P2
        -   warning：P3
        -   page：P4 |
        |开始时间|事件开始时间的时间戳。|
        |告警描述|告警事件的详细信息，用于告警通知。最多支持15000字符。|
        |对象类型|告警事件的对象类型，例如：主机。|
        |告警类型|告警事件的来源，集成类型。|
        |告警名称|自定义告警的名称。|
        |事件对象|事件对象的名称，最多支持512个字符。例如：主机test\_10.101.1.1。|
        |事件地址|事件详细信息地址。|
        |结束时间|事件结束时间的时间戳。|

    配置完成后，在集成页面可以查看已创建的自定义集成。

    ![自定义集成密钥](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1585391261/p272534.png)


## 步骤二：通过API发送告警到告警管理

1.  在集成页面，单击目标自定义集成的密钥，在集成详情页面复制集成密钥。

2.  在告警源中访问如下地址，并通过事件重定义字段自定义上报告警信息。

    `https://alerts.aliyuncs.com/api/v1/events/{{token}}`

    **说明：** `{{token}}`为集成的密钥。

    上报示例：

    ```
    curl -H "Content-Type: application/json" -v https://alerts.aliyuncs.com/api/v1/events/vAV*************Rjqe -d '{"labels": {"alertname": "手动测试告警","severity": "error"},"annotations": {"message": "这是一个测试告警无需处理"}}' 
    {"labels":{"_aliyun_arms_integration_name":"测试集成","alertname":"手动测试告警","_aliyun_arms_product_type":"CUSTOM","_aliyun_arms_integration_id":"424","_aliyun_arms_userid":"1131971649496228"},"annotations":{"message":"这是一个测试告警无需处理"},"startsAt":1618215228786,"endsAt":1618215528786,"generatorUrl":null,"services":null}* Closing connection 0
    ```


## 管理集成

对于已经创建的集成，您可以进行以下操作：

-   查看集成：如果您需要查看集成的详细信息，单击目标集成所在行，在集成详情页面查看集成的详细信息。
-   更新密钥：如果您需要修改集成的密钥，在目标集成右侧**操作**列选择**更多** \> **更新密钥**，在弹出的对话框中单击**确认**。

    **说明：** 更新秘钥后，请在告警源中修改访问地址，具体操作，请参见[步骤二：通过API发送告警到告警管理](#section_w6h_1ia_ccx)。

-   编辑：如果您需要修改集成信息，在目标集成右侧**操作**列单击**编辑**，在集成详情页面修改集成信息，然后单击**√**图标。
-   启用：如果您需要启用禁用状态的集成，在目标集成右侧**操作**列单击**启用**。
-   禁用：如果您需要禁用启用状态的集成，在目标集成右侧**操作**列单击**禁用**。
-   删除：如果您需要删除集成，在目标集成右侧**操作**列单击**删除**，在弹出的对话框中单击**确认**。

