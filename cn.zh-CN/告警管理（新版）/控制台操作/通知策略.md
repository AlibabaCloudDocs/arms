# 通知策略

通过设置通知策略，您可以制定针对告警事件的分派规则。当规则被触发时，系统会以您指定的通知方式向处理人发送告警信息，以提醒处理人采取必要的问题解决措施。

创建联系人，具体操作，请参见[联系人概述](/cn.zh-CN/告警管理（新版）/控制台操作/联系人管理/联系人概述.md)。

## 新建通知策略

1.  登录[ARMS控制台](https://arms.console.aliyun.com/#/home)。

2.  在左侧导航栏中选择**告警管理** \> **通知策略**。

3.  在通知策略列表区域单击**+新增策略**。

4.  在右侧区域顶部文本框中输入通知策略名称。

5.  在**分派规则**区域的进行以下操作。

    1.  选择告警过滤来源或不过滤来源。

        -   指定过滤来源：通知策略会针对指定来源的告警事件进行分派规则过滤并发送通知。
        -   不过滤来源：通知策略会针对所有告警事件进行分派规则过滤并发送通知。
    2.  设置分派条件表达式，您可以自定义标签或选择已有的标签。例如：alertname等于PodRestart。

        已有的标签包括以下三种：

        -   告警规则表达式指标中携带的标签。
        -   Prometheus监控通过告警规则创建的标签，请参见[创建报警]()。
        -   ARMS系统自带的默认标签，默认标签说明如下。

            |标签|说明|
            |--|--|
            |alertname|告警名称，格式为：告警名称\_集群名称。|
            |\_aliyun\_arms\_alert\_level|告警等级。|
            |\_aliyun\_arms\_alert\_type|告警类型。|
            |\_aliyun\_arms\_alert\_rule\_id|告警规则对应的ID。|
            |\_aliyun\_arms\_region\_id|地域ID。|
            |\_aliyun\_arms\_userid|用户ID。|
            |\_aliyun\_arms\_involvedObject\_type|关联对象子类型，如ManagedKubernetes，ServerlessKubernetes。|
            |\_aliyun\_arms\_involvedObject\_kind|关联对象分类，如app，cluster。|
            |\_aliyun\_arms\_involvedObject\_id|关联对象ID。|
            |\_aliyun\_arms\_involvedObject\_name|关联对象名称。|

        **说明：**

        -   如果需同时满足多个分派条件才告警，则单击**+条件**编辑第二条分派条件。
        -   如果需满足任意一个分派条件就告警，则单击**+添加规则**编辑第二条分派条件。
        ![Assignment rules](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4240504161/p181963.png)

6.  在事件处理区域，设置以下参数。

    ![Dispatch-event handling](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4053090261/p181956.png)

    |参数|说明|
    |--|--|
    |处理方式|    -   生成告警：将监测到的告警发送给联系人。
    -   不告警（丢弃事件）：监测到告警后不发送给联系人。
**说明：** 如果同时设置了两个相同的通知策略且处理方式分别设置为生成告警和不告警（丢弃事件），则不告警（丢弃事件）的优先级高于生成告警，即不会给联系人发送告警信息。 |
    |高级配置|
    |事件分组|    -   不分组：所有告警会以一条信息发送给处理人。
    -   指定相同字段内容的事件分到一个组：设置分组字段，相同字段的告警内容会分别通过独立信息发送给处理人。 |
    |等待时长|    -   分组等待时间：收到第一个告警后会等待设置的时间，之后在分组等待时间内收到的所有告警会以一条信息发送给处理人。
    -   分组间隔时间：如果有新告警产生，等待设置的时间后就会直接发送新的告警信息。 |
    |告警自动恢复|当告警下面全部事件都恢复时，告警状态是否自动恢复为已解决。当告警恢复时，系统将会发送通知给处理人。|

7.  在当告警生成时区域，设置以下参数。

    ![通知策略-当告警生成时](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4053090261/p271737.png)

    |参数|说明|
    |--|--|
    |通知人|通知人支持设置联系人、联系人组和钉群。联系人创建方法，请参见[联系人概述](/cn.zh-CN/告警管理（新版）/控制台操作/联系人管理/联系人概述.md)。|
    |通知方式|通知方式支持钉钉、邮件、WebHook、短信和电话，可以同时选择多种方式。**说明：**

    -   未验证手机号的联系人无法使用电话通知方式。验证手机号的操作，请参见[验证手机号](/cn.zh-CN/告警管理（新版）/控制台操作/联系人管理/联系人.md)。
    -   单击**通知模板**，可以在通知模板对话框中设置邮件、短信和电话的通知信息格式。 |
    |通知时段|告警会在设置的通知时段内重复发送告警通知。|
    |升级通知方式|对于长期未解决的告警可以选择重复通知或升级通知来提醒联系人及时解决。    -   重复通知：选择重复通知后，需要设置告警发送频率。所有告警会在指定通知时段内以设置的告警发送频率循环发送告警信息直至告警恢复。
    -   升级策略：选择升级策略后，需要选择已有的升级策略或添加一个新的升级策略。具体操作，请参见[升级策略](/cn.zh-CN/告警管理（新版）/控制台操作/升级策略.md)。

**说明：** 单击**详情**，可以查看当前选中的升级策略的详细信息。 |

8.  设置完成后，单击右上角的![通知策略-保存图标](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3424640261/p271745.png)图标。


## 管理通知策略

通知策略新建完成后会在通知策略列表中显示，您可以在通知策略列表中执行以下操作：

-   单击通知策略名称右侧的更多图标，选择**编辑**、**停用**、**启用**、**复制**或**删除**可以管理该通知策略。
-   单击目标通知策略，在右侧页面右上角选择相应的图标，可以编辑、刷新、复制和删除该通知策略。

