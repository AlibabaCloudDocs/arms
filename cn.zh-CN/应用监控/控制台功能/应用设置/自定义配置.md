# 自定义配置

应用监控的一些常用设置，例如调用链采样率、Agent开关、慢SQL阈值等，可直接在自定义配置页签上配置。

[创建应用监控任务](/cn.zh-CN/快速入门/创建应用监控任务.md)

## 功能入口

1.  登录[ARMS控制台](https://arms.console.aliyun.com/#/home)。

2.  在左侧导航栏中选择**应用监控** \> **应用列表**。

3.  在应用列表页面顶部选择目标地域，在应用列表页面单击目标应用的名称。

4.  在左侧导航栏中单击**应用设置**，并在右侧单击**自定义配置**页签。


**说明：** 设置完毕后，在页面底部单击**保存**方可生效。

## 配置调用链采样设置

在**调用链采样设置**区域，可以打开或关闭调用链采样开关，并设置采样率。**采样率设置**字段输入百分比的数字部分即可，例如输入10代表采样10%。

**说明：** 修改即时生效，无需重启应用。如果关闭采样，则调用链数据将不会被采集，请谨慎操作。

![Chain sampling](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1043580061/p169596.png)

## 配置Agent（探针）开关和日志级别

在**Agent开关配置**区域，可以打开或关闭探针总开关以及各插件开关，并配置日志级别。

**说明：** 探针总开关和日志级别的修改即时生效，无需重启应用。如果关闭探针总开关，则系统将无法监控您的应用，请谨慎操作。要使对各插件开关的修改生效，必须手动重启应用。

![Agent Switches](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1043580061/p43148.png)

## 配置阈值设置

在**阈值设置**区域，可以设置慢SQL查询阈值、接口响应时间阈值和限流阈值。

![Threshold Settings](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/9147290061/p43149.png)

## 配置高级设置

在**高级设置**区域，可以设置需过滤的接口、方法堆栈最大长度等。

![Advanced Settings](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1043580061/p43183.png)

-   **无效接口调用过滤**：输入不需要查看调用情况的接口，从而将其从接口调用页面隐去。
-   **方法堆栈最大长度**：默认为128条，最大值为400条。
-   **同类异常堆栈区分深度**：同类型异常，用于作为不同异常区分的堆栈深度，一般设置为第一个差异调用的深度。
-   **采集SQL最大长度**：默认为1024个字符，最小值为256，最大值为4096。
-   **采集SQL绑定值**：捕获PrepareStatement参数绑定的变量值，无需重启应用即可生效。
-   **原始SQL**：仅对SQL截断，不做额外处理。
-   **异常过滤**：此处输入的异常不会显示在应用详情和异常分析页面的图表中。
-   **错误数过滤**：默认情况下，大于400的状态码会计入错误数，您可以自定义大于400但不计入的HTTP状态码。
-   **调用链新格式**：采用支持调用链时间排序的新存储格式（默认打开）。
-   **调用链压缩**：是否将重复调用（比如for循环）简化，无需重启应用即生效。
-   **请求入参最大长度**：默认为512字符，支持的最大长度为2048字符。
-   **分位数统计**：是否开启分位数统计功能。
-   **应用紧急事件报警**：支持针线程死锁、OOM等紧急报警。[探针版本](/cn.zh-CN/应用监控/参考信息/Agent 版本说明.md)须为2.5.8+。
-   **RabbitMQ自定义消费者**：通过设置自定义消费者的类名或者包含匿名内部消费者的类名，可以看到该消费者的调用链路。多个消费者以英文逗号（,）分隔。

## 配置线程设置

在**线程设置**区域，可以打开或关闭线程诊断方法栈开关、线程剖析总控开关，并设置慢调用监听触发阈值。

![Thread Settings](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1043580061/p43185.png)

**说明：** 服务调用耗时超过慢调用监听触发阈值（默认值为1000毫秒）时才会启动监听，并一直持续到该次调用结束或超过15秒。建议将此阈值设为调用耗时的第99百分位数。假设有100次调用，则按耗时从小到大排序，排在第99位的耗时就是第99百分位数。

## 配置内存快照设置

在**内存快照设置**区域，可以启用或停用内存快照功能。打开此开关后，出现内存泄漏时将自动转储内存（一天至多一次）。

![Memory Snapshot](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/9147290061/p46550.png)

## 设置关联业务日志与TraceId

在**业务日志关联设置**区域，可以设置是否在应用的业务日志中关联调用链的TraceId信息，详情请参考[业务日志关联调用链的TraceId信息](/cn.zh-CN/应用监控/使用教程/业务日志关联调用链的TraceId信息.md)。

![Business log](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2327903061/p22045.png)

## 配置URL收敛规则

在**URL收敛设置**区域，可以打开或关闭收敛功能的开关，并设置收敛阈值和收敛规则。URL收敛是指将具有相似性的一系列URL作为一个单独的个体展示，例如将前半部分都为/service/demo/ 的一系列URL集中展示。收敛阈值是指要进行URL收敛的最低数量条件，例如当阈值为100时，则符合规则正则表达式的URL达到100时才会对它们进行收敛。

![URL Aggregation](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1043580061/p46552.png)

## 设置业务监控

在**业务监控设置**区域，可以打开或关闭业务监控开关，并设置HTTP编码。

![Business monitoring](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4129190061/p169619.png)

**相关文档**  


[调用链路查询](/cn.zh-CN/应用监控/控制台功能/调用链路查询.md)

[t152244.md\#](/cn.zh-CN/应用监控/控制台功能/应用接口调用监控.md)

[使用线程剖析诊断代码层面的问题](/cn.zh-CN/应用监控/使用教程/使用线程剖析诊断代码层面的问题.md)

[t152243.md\#](/cn.zh-CN/应用监控/控制台功能/应用详情/内存快照.md)

